"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[32782],{15680(e,n,t){t.d(n,{xA:()=>u,yg:()=>m});var r=t(96540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=a,g=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return t?r.createElement(g,i(i({ref:n},u),{},{components:t})):r.createElement(g,i({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},81002(e,n,t){t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>p,toc:()=>c});var r=t(58168),a=t(98587),o=(t(96540),t(15680)),i=["components"],s={id:"input",title:"Admission Review Input"},l=void 0,p={unversionedId:"input",id:"input",title:"Admission Review Input",description:"The data that's passed to Gatekeeper for review is in the form of an input.review object that stores the admission request under evaluation. It follows a structure that contains the object being created, and in the case of update operations the old object being updated. It has the following fields:",source:"@site/docs/input.md",sourceDirName:".",slug:"/input",permalink:"/gatekeeper/website/docs/next/input",draft:!1,editUrl:"https://github.com/open-policy-agent/gatekeeper/edit/master/website/docs/input.md",tags:[],version:"current",frontMatter:{id:"input",title:"Admission Review Input"},sidebar:"docs",previous:{title:"OPA Versions",permalink:"/gatekeeper/website/docs/next/opa-versions"},next:{title:"Background Information on Mutation",permalink:"/gatekeeper/website/docs/next/mutation-background"}},u={},c=[],d={toc:c};function m(e){var n=e.components,t=(0,a.A)(e,i);return(0,o.yg)("wrapper",(0,r.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"The data that's passed to Gatekeeper for review is in the form of an ",(0,o.yg)("inlineCode",{parentName:"p"},"input.review")," object that stores the ",(0,o.yg)("a",{parentName:"p",href:"https://pkg.go.dev/k8s.io/kubernetes/pkg/apis/admission#AdmissionRequest"},"admission request")," under evaluation. It follows a structure that contains the object being created, and in the case of update operations the old object being updated. It has the following fields:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"dryRun"),": Describes if the request was invoked by ",(0,o.yg)("inlineCode",{parentName:"li"},"kubectl --dry-run"),". This cannot be populated by Kubernetes for audit."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"kind"),": The resource ",(0,o.yg)("inlineCode",{parentName:"li"},"kind"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"group"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"version")," of the request object under evaluation."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"name"),": The name of the request object under evaluation. It may be empty if the deployment expects the API server to generate a name for the requested resource."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"namespace"),": The namespace name of the request object under evaluation. Empty for cluster scoped objects."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"namespaceObject"),": The full Namespace object (including metadata, labels, and annotations) for the request object under evaluation. This is ",(0,o.yg)("inlineCode",{parentName:"li"},"null")," for cluster-scoped resources. Available in Rego as ",(0,o.yg)("inlineCode",{parentName:"li"},"input.review.namespaceObject")," and in CEL as the ",(0,o.yg)("inlineCode",{parentName:"li"},"namespaceObject")," variable."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"object"),": The request object under evaluation to be created or modified."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"oldObject"),": The original state of the request object under evaluation. This is only available for UPDATE operations."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"operation"),": The operation for the request (e.g. CREATE, UPDATE). This cannot be populated by Kubernetes for audit."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"uid"),": The request's unique identifier. This cannot be populated by Kubernetes for audit."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"userInfo"),": The request's user's information such as ",(0,o.yg)("inlineCode",{parentName:"li"},"username"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"uid"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"groups"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"extra"),". This cannot be populated by Kubernetes for audit.")),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},(0,o.yg)("strong",{parentName:"p"},(0,o.yg)("em",{parentName:"strong"},"NOTE"))," For ",(0,o.yg)("inlineCode",{parentName:"p"},"input.review")," fields above that cannot be populated by Kubernetes for audit reviews, the constraint templates that rely on them are not auditable. It is up to the rego author to handle the case where these fields are unset and empty in order to avoid every matching resource being reported as violating resources. ")),(0,o.yg)("p",null,"You can see an example of the request structure below."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "apiVersion": "admission.k8s.io/v1",\n  "kind": "AdmissionReview",\n  "request": {\n    "uid": "abc123",\n    "kind": {\n      "group": "apps",\n      "version": "v1",\n      "kind": "Deployment"\n    },\n    "resource": {\n      "group": "apps",\n      "version": "v1",\n      "resource": "deployments"\n    },\n    "namespace": "default",\n    "operation": "CREATE",\n    "userInfo": {\n      "username": "john_doe",\n      "groups": ["developers"]\n    },\n    "object": {\n      // The resource object being created, updated, or deleted\n      "metadata": {\n        "name": "my-deployment",\n        "labels": {\n          "app": "my-app",\n          "env": "production"\n        }\n      },\n      "spec": {\n        // Specific configuration for the resource\n        "replicas": 3,\n        // ... other fields ...\n      }\n    },\n    "oldObject": {\n      // For update requests, the previous state of the resource\n      "metadata": {\n        "name": "my-deployment",\n        "labels": {\n          "app": "my-app",\n          "env": "staging"\n        }\n      },\n      "spec": {\n        // Previous configuration for the resource\n        "replicas": 2,\n        // ... other fields ...\n      }\n    }\n  }\n}\n')))}m.isMDXComponent=!0}}]);