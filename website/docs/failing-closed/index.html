<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/gatekeeper/website/blog/rss.xml" title="Gatekeeper Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gatekeeper/website/blog/atom.xml" title="Gatekeeper Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Gatekeeper" href="/gatekeeper/website/opensearch.xml"><title data-react-helmet="true">Failing Closed | Gatekeeper</title><meta data-react-helmet="true" property="og:url" content="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/failing-closed"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Failing Closed | Gatekeeper"><meta data-react-helmet="true" name="description" content="Here we discuss how to configure Gatekeeper to fail closed and some factors you may want to consider before doing so."><meta data-react-helmet="true" property="og:description" content="Here we discuss how to configure Gatekeeper to fail closed and some factors you may want to consider before doing so."><link data-react-helmet="true" rel="shortcut icon" href="/gatekeeper/website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/failing-closed"><link data-react-helmet="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/failing-closed" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/failing-closed" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/gatekeeper/website/assets/css/styles.862272d4.css">
<link rel="preload" href="/gatekeeper/website/assets/js/runtime~main.0289c9e5.js" as="script">
<link rel="preload" href="/gatekeeper/website/assets/js/main.bb612b43.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gatekeeper/website/"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Gatekeeper</strong></a><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/open-policy-agent/gatekeeper-library" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Library</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/gatekeeper/website/"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Gatekeeper</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/open-policy-agent/gatekeeper-library" target="_blank" rel="noopener noreferrer" class="menu__link">Library</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/examples">Examples</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">How to use Gatekeeper</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/howto">How to use Gatekeeper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/audit">Audit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/violations">Handling Constraint Violations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/sync">Replicating Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/exempt-namespaces">Exempting Namespaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/library">Policy Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/customize-startup">Customizing Startup Behavior</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/customize-admission">Customizing Admission Behavior</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/debug">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/emergency">Emergency Recovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/vendor-specific">Cloud and Vendor Specific Fixes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/gatekeeper/website/docs/failing-closed">Failing Closed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/mutation">Mutation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/help">Want to help?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/security">Security</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Failing Closed</h1></header><div class="markdown"><p>Here we discuss how to configure Gatekeeper to fail closed and some factors you may want to consider before doing so.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-fail-closed"></a>How to Fail Closed<a class="hash-link" href="#how-to-fail-closed" title="Direct link to heading">#</a></h2><p>If you installed Gatekeeper via the manifest, the only needed change is to set the <code>failurePolicy</code> field of Gatekeeper&#x27;s <code>ValidatingWebhookConfiguration</code> to <code>Fail</code>. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> admissionregistration.k8s.io/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ValidatingWebhookConfiguration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gatekeeper.sh/system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;yes&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gatekeeper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">validating</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">webhook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">webhooks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">admissionReviewVersions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> v1beta1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">clientConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">caBundle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> SOME_CERT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gatekeeper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">webhook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gatekeeper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /v1/admit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">failurePolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Fail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">matchPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Exact</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> validation.gatekeeper.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespaceSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">matchExpressions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> admission.gatekeeper.sh/ignore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> DoesNotExist</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">apiVersions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">operations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> CREATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> UPDATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sideEffects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">timeoutSeconds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">admissionReviewVersions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> v1beta1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">clientConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">caBundle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> SOME_CERT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gatekeeper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">webhook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gatekeeper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /v1/admitlabel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">failurePolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Fail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">matchPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Exact</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ignore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">label.gatekeeper.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespaceSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">objectSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">apiGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">apiVersions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">operations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> CREATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> UPDATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> namespaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sideEffects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">timeoutSeconds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you installed Gatekeeper via any other method (Helm chart, operator), please consult the documentation for that method.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="considerations"></a>Considerations<a class="hash-link" href="#considerations" title="Direct link to heading">#</a></h2><p>Here are some factors you may want to consider before configuring Gatekeeper to fail closed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="admission-deadlock"></a>Admission Deadlock<a class="hash-link" href="#admission-deadlock" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h4><p>It is possible to put the cluster in a state where automatic self-healing is impossible. Imagine you delete every <code>Node</code> in your cluster. This will kill all running Gatekeeper servers, which means the webhook will fail. Because a request to add a <code>Node</code> is subject to admission validation, it cannot succeed until the webhook can serve. The webhook cannot serve until a <code>Node</code> is added. This circular dependency will need to be broken before the cluster&#x27;s control plane can recover.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mitigation"></a>Mitigation<a class="hash-link" href="#mitigation" title="Direct link to heading">#</a></h4><p>This can normally be mitigated by deleting the <code>ValidatingWebhookConfiguration</code>, per the <a href="/gatekeeper/website/docs/emergency">emergency procedure</a>.</p><p>Note that it should always be possible to modify or delete the <code>ValidatingWebhookConfiguration</code> because Kubernetes does not make requests to edit webhook configurations subject to admission webhooks.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="potential-gotchas"></a>Potential Gotchas<a class="hash-link" href="#potential-gotchas" title="Direct link to heading">#</a></h4><p>If the existence of the webhook resource is enforced by some external process (such as an operator), that may interfere with the emergency recovery process. If this applies, it would be good to have a plan in place to deal with that scenario.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cluster-control-plane-availability"></a>Cluster Control Plane Availability<a class="hash-link" href="#cluster-control-plane-availability" title="Direct link to heading">#</a></h3><p>Because the webhook is being called for all K8s API server requests (under the default configuration), the availability of K8s&#x27;s control plane becomes subject to the availability of the webhook. It is important to have an idea of your expected API server availability <a href="https://en.wikipedia.org/wiki/Service-level_objective" target="_blank" rel="noopener noreferrer">SLO</a> and make sure Gatekeeper is configured to support that.</p><p>Below are some potential ways to do that and their gotchas.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="limit-the-gatekeeper-webhooks-scope"></a>Limit the Gatekeeper Webhook&#x27;s Scope<a class="hash-link" href="#limit-the-gatekeeper-webhooks-scope" title="Direct link to heading">#</a></h4><p>It is possible to exempt certain namespaces from being subject to the webhook, or to only call the webhook for certain kinds. This could be one way to prevent the webhook from interfering with sensitive processes.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="potential-gotchas-1"></a>Potential Gotchas<a class="hash-link" href="#potential-gotchas-1" title="Direct link to heading">#</a></h5><p>It can be hard to say for certain that all critical resources have been exempted because dependencies can be non-obvious. Some examples:</p><ul><li>Exempting <code>kube-system</code> namespace is a good starting place, but what about cluster-scoped resources, like nodes? What about other potentially critical namespaces like <code>istio-system</code>?</li><li>Some seemingly innocuous kinds can actually play a critical role in cluster operations. Did you know that a <code>ConfigMap</code> is used as the locking resource for some Kubernetes leader elections?</li></ul><p>If you are relying on exempting resources to keep your cluster available, be sure you know all the critical dependencies of your cluster. Unfortunately this is very cluster-specific, so there is no general guidance to be offered here.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="harden-your-deployment"></a>Harden Your Deployment<a class="hash-link" href="#harden-your-deployment" title="Direct link to heading">#</a></h4><p>Gatekeeper attempts to be resilient out-of-the-box by running its webhook in multiple pods. You can take that work and adapt it to your cluster by adding the appropriate node selectors and scaling the number of nodes up or down as desired.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="impact-of-scaling-nodes"></a>Impact of Scaling Nodes<a class="hash-link" href="#impact-of-scaling-nodes" title="Direct link to heading">#</a></h5><p>Putting hard numbers on the impact scaling resources has on Gatekeeper&#x27;s availability depends on the specifics of the underlying hardware of your cluster and how Gatekeeper is distributed across it, but there are some general themes:</p><ul><li>Increasing the number of webhook pods should increase QPS serving capacity</li><li>Increasing the number of webhook pods tends to increase uptime of the service</li><li>Increasing the number of webhook pods may increase the time it takes for a constraint to be enforced by all pods in the system</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="potential-gotcha-failure-domains"></a>Potential Gotcha: Failure Domains<a class="hash-link" href="#potential-gotcha-failure-domains" title="Direct link to heading">#</a></h5><p>Increasing the number of pods increases the theoretical uptime of a system under the theory that if one pod goes down the other pods continue to serve and pick up the slack. This assumption fails if multiple pods fail at the same time due to the same root cause. This happens when multiple pods are in the same <a href="https://en.wikipedia.org/wiki/Failure_domain#:~:text=In%20computing%2C%20a%20failure%20domain,of%20infrastructure%20that%20could%20fail." target="_blank" rel="noopener noreferrer">failure domain</a>.</p><p>Here are some common ways for two pods to be in the same failure domain:</p><ul><li>Running on the same node</li><li>Running on the same physical host (e.g. multiple nodes are VMs backed by the same physical machine)</li><li>Running on different physical hosts with the same network switch</li><li>Running on different physical hosts with the same power supply</li><li>Running on different physical hosts in the same rack</li></ul><p>Different clusters may have different backing physical infrastructures and different risk tolerances. Because of this, there is no definitive list of failure domains or guidance on how that should affect your setup.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-is-this-hard"></a>Why Is This Hard?<a class="hash-link" href="#why-is-this-hard" title="Direct link to heading">#</a></h2><p>In a nutshell it&#x27;s because it&#x27;s a webhook, and because it&#x27;s self-hosted. All REST servers require enough high-availabily infrastructure to satisfy their SLOs (see cloud availability zones / regions). Self-hosted webhooks create a circular dependency that has the potential to interfere with the self-healing Kubenetes usually provides. Any self-hosted admission webhook would be subject to these same concerns.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/open-policy-agent/gatekeeper/edit/master/website/docs/failing-closed.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gatekeeper/website/docs/vendor-specific"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Cloud and Vendor Specific Fixes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gatekeeper/website/docs/mutation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mutation Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-fail-closed" class="table-of-contents__link">How to Fail Closed</a></li><li><a href="#considerations" class="table-of-contents__link">Considerations</a><ul><li><a href="#admission-deadlock" class="table-of-contents__link">Admission Deadlock</a></li><li><a href="#cluster-control-plane-availability" class="table-of-contents__link">Cluster Control Plane Availability</a></li></ul></li><li><a href="#why-is-this-hard" class="table-of-contents__link">Why Is This Hard?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://openpolicyagent.slack.com/messages/CDTN970AX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://docs.google.com/document/d/1A1-Q-1OMw3QODs1wT6eqfLTagcGmgzAJAjJihiO3T48/edit)" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetings</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/gatekeeper/website/assets/js/runtime~main.0289c9e5.js"></script>
<script src="/gatekeeper/website/assets/js/main.bb612b43.js"></script>
</body>
</html>