<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v3.18.x plugin-docs plugin-id-default docs-doc-id-performance-tuning" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Performance Tuning | Gatekeeper</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://open-policy-agent.github.io/gatekeeper/website/docs/v3.18.x/performance-tuning"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v3.18.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v3.18.x"><meta data-rh="true" name="docsearch:version" content="v3.18.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v3.18.x"><meta data-rh="true" property="og:title" content="Performance Tuning | Gatekeeper"><meta data-rh="true" name="description" content="Below we go into some of the considerations and options for performance tuning Gatekeeper."><meta data-rh="true" property="og:description" content="Below we go into some of the considerations and options for performance tuning Gatekeeper."><link data-rh="true" rel="icon" href="/gatekeeper/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://open-policy-agent.github.io/gatekeeper/website/docs/v3.18.x/performance-tuning"><link data-rh="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs/v3.18.x/performance-tuning" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs/v3.18.x/performance-tuning" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PT2IX43ZFM-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-73GS7H3M4S"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-73GS7H3M4S",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Gatekeeper" href="/gatekeeper/website/opensearch.xml"><link rel="stylesheet" href="/gatekeeper/website/assets/css/styles.b76de634.css">
<link rel="preload" href="/gatekeeper/website/assets/js/runtime~main.37a6409c.js" as="script">
<link rel="preload" href="/gatekeeper/website/assets/js/main.c6e11319.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://open-policy-agent.github.io/gatekeeper/website/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Gatekeeper</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gatekeeper/website/docs/">Docs</a><a href="https://open-policy-agent.github.io/gatekeeper-library/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Policy Library<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/gatekeeper/website/docs/v3.18.x/">v3.18.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/gatekeeper/website/docs/next/performance-tuning">Next</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/performance-tuning">v3.20.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.19.x/performance-tuning">v3.19.x</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/gatekeeper/website/docs/v3.18.x/performance-tuning">v3.18.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.17.x/performance-tuning">v3.17.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.16.x/performance-tuning">v3.16.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.15.x/performance-tuning">v3.15.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.14.x/performance-tuning">v3.14.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.13.x/performance-tuning">v3.13.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.12.x/performance-tuning">v3.12.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.11.x/performance-tuning">v3.11.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.10.x/performance-tuning">v3.10.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.9.x/">v3.9.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.8.x/">v3.8.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.7.x/">v3.7.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.6.x/">v3.6.x</a></li></ul></div><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/gatekeeper/website/docs/v3.18.x/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/install">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/examples">Examples</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/gatekeeper/website/docs/v3.18.x/howto">How to use Gatekeeper</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/howto">How to use Gatekeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/audit">Audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/violations">Handling Constraint Violations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/sync">Replicating Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/exempt-namespaces">Exempting Namespaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/library">Policy Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/customize-startup">Customizing Startup Behavior</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/customize-admission">Customizing Admission Behavior</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/metrics">Metrics &amp; Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/debug">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/emergency">Emergency Recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/vendor-specific">Cloud and Vendor Specific Fixes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/failing-closed">Failing Closed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/mutation">Mutation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/constrainttemplates">Constraint Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/externaldata">External Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/expansion">Validating Workload Resources using ExpansionTemplate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/gator">The gator CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/workload-resources">Working with Workload Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/pubsub">Consuming violations using Pubsub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/validating-admission-policy">Integration with Kubernetes Validating Admission Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/enforcement-points">Enforcement points in Gatekeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/runtime-flags">Runtime Flags</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/gatekeeper/website/docs/v3.18.x/operations">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/operations">Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/performance-tuning">Performance Tuning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/opa-versions">OPA Versions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/gatekeeper/website/docs/v3.18.x/input">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/input">Admission Review Input</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/mutation-background">Background Information on Mutation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/gatekeeper/website/docs/v3.18.x/developers">Contributing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/developers">Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/help">How to contribute</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/v3.18.x/pubsub-driver">Pubsub Interface/Driver walkthrough</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Gatekeeper<!-- --> <b>v3.18.x</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/gatekeeper/website/docs/performance-tuning">latest version</a></b> (<!-- -->v3.20.x<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/gatekeeper/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Performance Tuning</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v3.18.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Performance Tuning</h1></header><p>Below we go into some of the considerations and options for performance tuning Gatekeeper.</p><h1>General Performance</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gomaxprocs">GOMAXPROCS<a href="#gomaxprocs" class="hash-link" aria-label="Direct link to GOMAXPROCS" title="Direct link to GOMAXPROCS">​</a></h2><p><a href="https://pkg.go.dev/runtime#GOMAXPROCS" target="_blank" rel="noopener noreferrer">GOMAXPROCS</a> sets the number of threads golang uses.
Gatekeeper uses <a href="https://github.com/uber-go/automaxprocs" target="_blank" rel="noopener noreferrer">automaxprocs</a> to default this value
to the CPU limit set by the linux cgroup (i.e. the limits passed to the Kubernetes container).</p><p>This value can be overridden by setting a <code>GOMAXPROCS</code> environment variable.</p><p>Generally speaking, too many threads can lead to CPU throttling, which can increase webhook jitter
and can result in not enough available CPU per operation, which can lead to increased latency.</p><h1>Webhook Performance</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="max-serving-threads">Max Serving Threads<a href="#max-serving-threads" class="hash-link" aria-label="Direct link to Max Serving Threads" title="Direct link to Max Serving Threads">​</a></h2><p>The <code>--max-serving-threads</code> command line flag caps the number of concurrent goroutines that are
calling out to policy evaluation at any one time. This can be important for two reasons:</p><ul><li><p>Excessive numbers of serving goroutines can lead to CPU starvation, which means there is not enough
CPU to go around per goroutine, causing requests to time out.</p></li><li><p>Each serving goroutine can require a non-trivial amount of RAM, which will not be freed until the
request is finished. This can increase the maximum memory used by the process, which can lead to
OOMing.</p></li></ul><p>By default, the number of webhook threads is capped at the value of <code>GOMAXPROCS</code>. If your policies mostly
rely on blocking calls (e.g. calling out to external services via <code>http.send()</code> or via external data), CPU
starvation is less of a risk, though memory scaling could still be a concern.</p><p>Playing around with this value may help maximize the throughput of Gatekeeper&#x27;s validating webhook.</p><h1>Audit</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="audit-interval">Audit Interval<a href="#audit-interval" class="hash-link" aria-label="Direct link to Audit Interval" title="Direct link to Audit Interval">​</a></h2><p>The <code>--audit-interval</code> flag is used to configure how often audit runs on the cluster.</p><p>The time it takes for audit to run is dependent on the size of the cluster, any throttling the K8s
API server may do, and the number and complexity of policies to be evaluated. As such, determining
the ideal audit interval is use-case-specific.</p><p>If you have overlapping audits, the following things can happen:</p><ul><li><p>There will be parallel calls to the policy evaluation backend, which can result in increased
RAM usage and CPU starvation, leading to OOMs or audit sessions taking longer per-audit than
they otherwise would.</p></li><li><p>More requests to the K8s API server. If throttled, this can increase the time it takes for an audit
to finish.</p></li><li><p>A newer audit run can pre-empt the reporting of audit results of a previous audit run on the <code>status</code> field
of individual constraints. This can lead to constraints not having violation results in their <code>status</code> field.
Reports via stdout logging should be unaffected by this.</p></li></ul><p>Ideally, <code>--audit-interval</code> should be set long enough that no more than one audit is running at any time, though
occasional overlap should not be harmful.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="constraint-violations-limit">Constraint Violations Limit<a href="#constraint-violations-limit" class="hash-link" aria-label="Direct link to Constraint Violations Limit" title="Direct link to Constraint Violations Limit">​</a></h2><p>Memory usage will increase/decrease as <code>--constraint-violations-limit</code> is increased/decreased.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="audit-chunk-size">Audit Chunk Size<a href="#audit-chunk-size" class="hash-link" aria-label="Direct link to Audit Chunk Size" title="Direct link to Audit Chunk Size">​</a></h2><p>The <code>--audit-chunk-size</code> flags tells Gatekeeper to request lists of objects from the API server to be paginated
rather than listing all instances at once. Setting this can reduce maximum memory usage, particularly if you
have a cluster with a lot of objects of a specific kind, or a particular kind that has very large objects (say config maps).</p><p>One caveat about <code>--audit-chunk-size</code> is that the K8s API server returns a resumption token for list requests. This
token is only valid for a short window (~O(minutes)) and the listing of all objects for a given kind must be completed
before that token expires. Decreasing <code>--audit-chunk-size</code> should decrease maximum memory usage, but may also lead
to an increase in requests to the API server. In cases where this leads to throttling, it&#x27;s possible the resumption token
could expire before object listing has completed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="match-kind-only">Match Kind Only<a href="#match-kind-only" class="hash-link" aria-label="Direct link to Match Kind Only" title="Direct link to Match Kind Only">​</a></h2><p>The <code>--audit-match-kind-only</code> flag can be helpful in reducing audit runtime, outgoing API requests and memory usage
if your constraints are only matching against a specific subset of kinds, particularly if there are large volumes
of config that can be ignored due to being out-of-scope. Some caveats:</p><ul><li><p>If the bulk of the K8s objects are resources that are already in-scope for constraints, the benefit will be mitigated</p></li><li><p>If a constraint is added that matches against all kinds (say a label constraint), the benefit will be eliminated. If
you are relying on this flag, it&#x27;s important to make sure all constraints added to the cluster have <code>spec.match.kind</code>
specified.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/open-policy-agent/gatekeeper/edit/master/website/versioned_docs/version-v3.18.x/performance-tuning.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/gatekeeper/website/docs/v3.18.x/operations"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Operations</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/gatekeeper/website/docs/v3.18.x/opa-versions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OPA Versions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#gomaxprocs" class="table-of-contents__link toc-highlight">GOMAXPROCS</a></li><li><a href="#max-serving-threads" class="table-of-contents__link toc-highlight">Max Serving Threads</a></li><li><a href="#audit-interval" class="table-of-contents__link toc-highlight">Audit Interval</a></li><li><a href="#constraint-violations-limit" class="table-of-contents__link toc-highlight">Constraint Violations Limit</a></li><li><a href="#audit-chunk-size" class="table-of-contents__link toc-highlight">Audit Chunk Size</a></li><li><a href="#match-kind-only" class="table-of-contents__link toc-highlight">Match Kind Only</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://slack.openpolicyagent.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack (#opa-gatekeeper)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.google.com/document/d/1A1-Q-1OMw3QODs1wT6eqfLTagcGmgzAJAjJihiO3T48/edit" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetings<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/gatekeeper/website/assets/js/runtime~main.37a6409c.js"></script>
<script src="/gatekeeper/website/assets/js/main.c6e11319.js"></script>
</body>
</html>