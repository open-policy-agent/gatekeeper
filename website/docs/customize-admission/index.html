<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/gatekeeper/website/blog/rss.xml" title="Gatekeeper Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gatekeeper/website/blog/atom.xml" title="Gatekeeper Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Gatekeeper" href="/gatekeeper/website/opensearch.xml"><title data-react-helmet="true">Customizing Admission Behavior | Gatekeeper</title><meta data-react-helmet="true" property="og:url" content="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/customize-admission"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Customizing Admission Behavior | Gatekeeper"><meta data-react-helmet="true" name="description" content="Gatekeeper is a Kubernetes admission webhook"><meta data-react-helmet="true" property="og:description" content="Gatekeeper is a Kubernetes admission webhook"><link data-react-helmet="true" rel="shortcut icon" href="/gatekeeper/website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/customize-admission"><link data-react-helmet="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/customize-admission" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/customize-admission" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/gatekeeper/website/assets/css/styles.862272d4.css">
<link rel="preload" href="/gatekeeper/website/assets/js/runtime~main.0289c9e5.js" as="script">
<link rel="preload" href="/gatekeeper/website/assets/js/main.bb612b43.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gatekeeper/website/"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Gatekeeper</strong></a><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/open-policy-agent/gatekeeper-library" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Library</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/gatekeeper/website/"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Gatekeeper</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/open-policy-agent/gatekeeper-library" target="_blank" rel="noopener noreferrer" class="menu__link">Library</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/examples">Examples</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">How to use Gatekeeper</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/howto">How to use Gatekeeper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/audit">Audit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/violations">Handling Constraint Violations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/sync">Replicating Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/exempt-namespaces">Exempting Namespaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/library">Policy Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/customize-startup">Customizing Startup Behavior</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/gatekeeper/website/docs/customize-admission">Customizing Admission Behavior</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/debug">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/emergency">Emergency Recovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/vendor-specific">Cloud and Vendor Specific Fixes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/failing-closed">Failing Closed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/mutation">Mutation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/help">Want to help?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/security">Security</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Customizing Admission Behavior</h1></header><div class="markdown"><p>Gatekeeper is a <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-configuration" target="_blank" rel="noopener noreferrer">Kubernetes admission webhook</a>
whose default configuration can be found in the <code>gatekeeper.yaml</code> manifest file. By default, it is
a <code>ValidatingWebhookConfiguration</code> resource named <code>gatekeeper-validating-webhook-configuration</code>.</p><p>Currently the configuration specifies two webhooks: one for checking a request against
the installed constraints and a second webhook for checking labels on namespace requests
that would result in bypassing constraints for the namespace. The namespace-label webhook
is necessary to prevent a privilege escalation where the permission to add a label to a
namespace is equivalent to the ability to bypass all constraints for that namespace.
You can read more about the ability to exempt namespaces by label <a href="/gatekeeper/website/docs/exempt-namespaces#exempting-namespaces-from-the-gatekeeper-admission-webhook-using---exempt-namespace-flag">here</a>.</p><p>Because Kubernetes adds features with each version, if you want to know how the webhook can be configured it
is best to look at the official documentation linked at the top of this section. However, two particularly important
configuration options deserve special mention: <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#timeouts" target="_blank" rel="noopener noreferrer">timeouts</a> and
<a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#failure-policy" target="_blank" rel="noopener noreferrer">failure policy</a>.</p><p>Timeouts allow you to configure how long the API server will wait for a response from the admission webhook before it
considers the request to have failed. Note that setting the timeout longer than the overall request timeout
means that the main request will time out before the webhook&#x27;s failure policy is invoked.</p><p>Failure policy controls what happens when a webhook fails for whatever reason. Common
failure scenarios include timeouts, a 5xx error from the server or the webhook being unavailable.
You have the option to ignore errors, allowing the request through, or failing, rejecting the request.
This results in a direct tradeoff between availability and enforcement.</p><p>Currently Gatekeeper is defaulting to using <code>Ignore</code> for the constraint requests. This is because
the webhook server currently only has one instance, which risks downtime during actions like upgrades.
As the theoretical availability improves we will likely change the default to <code>Fail</code>.</p><p>The namespace label webhook defaults to <code>Fail</code>, this is to help ensure that policies preventing
labels that bypass the webhook from being applied are enforced. Because this webhook only gets
called for namespace modification requests, the impact of downtime is mitigated, making the
theoretical maximum availability less of an issue.</p><p>Because the manifest is available for customization, the webhook configuration can
be tuned to meet your specific needs if they differ from the defaults.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="enable-delete-operations"></a>Enable Delete Operations<a class="hash-link" href="#enable-delete-operations" title="Direct link to heading">#</a></h2><p>To enable Delete operations for the <code>validation.gatekeeper.sh</code> admission webhook, add &quot;DELETE&quot; to the list of operations in the <code>gatekeeper-validating-webhook-configuration</code> ValidatingWebhookConfiguration as seen in this deployment manifest of gatekeeper: <a href="https://github.com/open-policy-agent/gatekeeper/blob/v3.1.0-beta.10/deploy/gatekeeper.yaml#L792-L794" target="_blank" rel="noopener noreferrer">here</a>
Note: For admission webhooks registered for DELETE operations, use Kubernetes v1.15.0+</p><p> So you have</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly YAML"><div tabindex="0" class="prism-code language-YAML codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   operations:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - CREATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - UPDATE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - DELETE</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can now check for deletes.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/open-policy-agent/gatekeeper/edit/master/website/docs/customize-admission.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gatekeeper/website/docs/customize-startup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Customizing Startup Behavior</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gatekeeper/website/docs/metrics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metrics Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enable-delete-operations" class="table-of-contents__link">Enable Delete Operations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://openpolicyagent.slack.com/messages/CDTN970AX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://docs.google.com/document/d/1A1-Q-1OMw3QODs1wT6eqfLTagcGmgzAJAjJihiO3T48/edit)" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meetings</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/gatekeeper/website/assets/js/runtime~main.0289c9e5.js"></script>
<script src="/gatekeeper/website/assets/js/main.bb612b43.js"></script>
</body>
</html>